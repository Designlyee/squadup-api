<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Event - SquadUp!</title>
    <link rel="stylesheet" href="style/style.css">
</head>

<body>
    <div class="container">
        <section class="hero">
            <header>
                <a href="./index.html"><img src="./images/logo.png" alt="SquadUp Logo" class="logo"></a>
                <div class="nav">
                    <nav>
                        <a href="#about">About us</a>
                        <a href="#local">Local Events</a>
                        <a href="#online">Online Events</a>
                        <a href="#friends">Find Friends</a>
                        <a href="#career">Career</a>
                    </nav>
                    <a href="#register" class="register-btn">Register an Event</a>
                </div>
            </header>
            <div class="hero-content">
                <div>
                    <h1>SquadUp!</h1>
                    <p>SquadUp! is the event platform for Canadian newcomers, helping individuals and organizations
                        create and manage both local and online events effortlessly. Designed to help new immigrants
                        find friends and build networks.</p>
                    <div class="start-btn">Start a New Event</div>
                </div>
                <img src="./images/banner.png" alt="Megaphone Illustration" style="width: 400px;">
            </div>
        </section>

        <section class="local-events">
            <div class="section-header">
                <h2 class="section-title">Edit/Add Your Event</h2>
                <p class="section-subtitle">Step-by-Step Guide to prompt your event!</p>
            </div>

            <div class="section-form">
                <div style="display: flex; justify-content: flex-end;">
                    <!-- Delete Event Button -->
                    <button id="deleteBtn" class="delete-btn">
                        <svg width="27" height="27" viewBox="0 0 27 27" fill="none">
                            <!-- SVG code for button icon -->
                        </svg>
                        Delete Event
                    </button>
                </div>

                <form>
                    <!-- Event color selection section -->
                    <div class="form-section color-section">
                        <div class="form-header">
                            <div class="form-number">01</div>
                            <div class="form-title">Event Colour</div>
                        </div>
                        <div class="color-options">
                            <label for="primary-color">Primary color</label>
                            <input type="color" id="primary-color" class="color-option" value="#e0d6ff">
                            <label for="secondary-color">Secondary color</label>
                            <input type="color" id="secondary-color" class="color-option" value="#98ff98">
                        </div>
                    </div>

                    <!-- Event name and photo upload sections -->
                    <div style="display: flex; justify-content: space-between; gap: 20px;">
                        <div class="form-section name-section" style="width: 50%;">
                            <div class="form-header">
                                <div class="form-number">02</div>
                                <div class="form-title">Event Name <span class="char-limit">Less than 6 words</span></div>
                            </div>
                            <input type="text" id="eventName" class="form-input" placeholder="Enter event name">
                        </div>

                        <!-- Event photo upload -->
                        <div class="form-section upload-section" style="width: 50%; text-align: center;">
                            <div id="imagePreview" style="display: none;">
                                <div class="preview-container">
                                    <button type="button" class="delete-image-btn" onclick="deleteImage()">Delete</button>
                                    <img id="previewImg" style="max-width: 200px; max-height: 200px; object-fit: cover;">
                                </div>
                            </div>
                            <div id="uploadArea">
                                <div class="upload-icon">
                                    <svg width="75" height="76" viewBox="0 0 75 76" fill="none">
                                        <!-- SVG code for upload icon -->
                                    </svg>
                                </div>
                                <div class="upload-text">Drag and Upload Event Photo here <br>or</div>
                                <input type="file" id="eventPhoto" accept="image/*" style="display: none;">
                                <button type="button" class="upload-button"
                                    onclick="document.getElementById('eventPhoto').click();">Select File</button>
                            </div>
                        </div>
                    </div>

                    <!-- Event description section -->
                    <div class="form-section description-section">
                        <div class="form-header">
                            <div class="form-number">03</div>
                            <div class="form-title">Event Description <span class="char-limit">Less than 150 words</span>
                            </div>
                        </div>
                        <input type="text" id="eventDescription" class="form-input" placeholder="Describe your event">
                    </div>

                    <!-- Event date and cost sections -->
                    <div style="display: flex; justify-content: space-between; gap: 20px;">
                        <div class="form-section date-section" style="width: 50%;">
                            <div class="form-header">
                                <div class="form-number">04</div>
                                <div class="form-title">Event Date</div>
                            </div>
                            <input type="date" id="eventDate" class="form-input" placeholder="Select date">
                        </div>
                        <div class="form-section price-section" style="width: 50%; display: flex; gap: 10px;">
                            <div>
                                <div class="form-header">
                                    <div class="form-title">How much does it cost?</div>
                                </div>
                                <input type="text" id="eventCost" class="form-input"
                                    placeholder="Enter cost">
                            </div>
                        </div>
                    </div>

                    <!-- Family-friendly toggle section -->
                    <div class="form-section family-section">
                        <div class="form-header">
                            <div class="form-number">05</div>
                            <div class="form-title">Family Friendly</div>
                        </div>
                        <div class="toggle-container">
                            <label class="toggle-label">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="familyFriendly">
                                    <span class="toggle-slider"></span>
                                </div>
                                Yes, it's very family friendly
                            </label>
                        </div>
                    </div>

                    <!-- Contact information section -->
                    <div class="form-section contact-section">
                        <div class="form-header">
                            <div class="form-number">06</div>
                            <div class="form-title">Contact Information</div>
                        </div>
                        <input type="text" id="eventContact" class="form-input" placeholder="Enter contact details">
                    </div>

                    <!-- Event location options -->
                    <div class="form-section location-section">
                        <div class="form-header">
                            <div class="form-number">07</div>
                            <div class="form-title">Event Location</div>
                        </div>
                        <div class="location-options">
                            <label class="location-option">
                                <input type="radio" name="eventLocation" value="Toronto, Ontario">
                                <span class="location-text">Toronto, Ontario</span>
                            </label>
                            <label class="location-option">
                                <input type="radio" name="eventLocation" value="Calgary, Alberta">
                                <span class="location-text">Calgary, Alberta</span>
                            </label>
                            <label class="location-option">
                                <input type="radio" name="eventLocation" value="Montreal, Quebec">
                                <span class="location-text">Montreal, Quebec</span>
                            </label>
                            <!-- Additional locations -->
                        </div>
                    </div>

                    <button type="submit" class="save-button">Save</button>
                </form>
            </div>
        </section>

        <section class="contact-section">
            <h2 class="contact-title">Contact Us</h2>
            <div class="contact">
                <div class="contact-form">
                    <form>
                        <!-- Contact form for inquiries -->
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label>Email*</label>
                            <input type="email" placeholder="Email">
                        </div>
                        <div class="form-group">
                            <label>Message*</label>
                            <textarea placeholder="Message"></textarea>
                        </div>
                        <button type="submit" class="submit-btn">Send Message</button>
                    </form>
                </div>
                <div class="contact-image"><img src="./images/illustration.png" alt=""></div>
            </div>
        </section>
    </div>
</body>

<script>
    let currentEventId = null;

    // Load event data into the form if an event ID exists
    async function loadEvent() {
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');

        if (eventId) {
            currentEventId = eventId;
            document.getElementById('deleteBtn').style.display = 'flex';

            try {
                const response = await fetch(`http://localhost:8000/api/events/${eventId}`);
                const event = await response.json();

                // Populate form fields
                document.getElementById('eventName').value = event.name;
                document.getElementById('eventDescription').value = event.description;
                document.getElementById('eventDate').value = event.date;

                const locationRadios = document.getElementsByName('eventLocation');
                locationRadios.forEach(radio => {
                    if (radio.value === event.location) {
                        radio.checked = true;
                    }
                });

                document.getElementById('eventContact').value = event.contactInfo;
                document.getElementById('familyFriendly').checked = event.familyFriendly;
                document.getElementById('primary-color').value = event.color.primary;
                document.getElementById('secondary-color').value = event.color.secondary;
                document.getElementById('eventCost').value = event.eventCost;

                // Display uploaded image preview
                if (event.eventPhoto) {
                    document.getElementById('previewImg').src = `http://localhost:8000${event.eventPhoto}`;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('uploadArea').style.display = 'none';
                    document.getElementById('eventPhoto').dataset.filepath = event.eventPhoto;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    }

    // File upload preview
    document.getElementById('eventPhoto').addEventListener('change', async function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('uploadArea').style.display = 'none';
            }
            reader.readAsDataURL(file);

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('http://localhost:8000/api/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                document.getElementById('eventPhoto').dataset.filepath = data.filePath;
            } catch (error) {
                console.error('Error uploading file:', error);
            }
        }
    });

    // Delete uploaded image
    function deleteImage() {
        document.getElementById('previewImg').src = '';
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('uploadArea').style.display = 'block';
        document.getElementById('eventPhoto').value = '';
        document.getElementById('eventPhoto').dataset.filepath = '';
    }

    // Form submission handling
    document.querySelector('form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const eventData = {
            name: document.getElementById('eventName').value,
            description: document.getElementById('eventDescription').value,
            date: document.getElementById('eventDate').value,
            location: document.querySelector('input[name="eventLocation"]:checked').value,
            contactInfo: document.getElementById('eventContact').value,
            familyFriendly: document.getElementById('familyFriendly').checked,
            color: {
                primary: document.getElementById('primary-color').value,
                secondary: document.getElementById('secondary-color').value
            },
            eventPhoto: document.getElementById('eventPhoto').dataset.filepath || '',
            eventCost: document.getElementById('eventCost').value
        };

        const url = currentEventId
            ? `http://localhost:8000/api/events/${currentEventId}`
            : 'http://localhost:8000/api/events';

        const method = currentEventId ? 'PUT' : 'POST';

        try {
            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(eventData)
            });

            if (response.ok) {
                window.location.href = 'index.html';
            }
        } catch (error) {
            console.error('Error:', error);
        }
    });

    // Delete event handling
    document.getElementById('deleteBtn').addEventListener('click', async () => {
        if (currentEventId && confirm('Are you sure you want to delete this event?')) {
            try {
                const response = await fetch(`http://localhost:8000/api/events/${currentEventId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    window.location.href = 'index.html';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    });

    // Load event on page load
    document.addEventListener('DOMContentLoaded', loadEvent);

    // Contact form submission
    document.querySelector('.contact-form form').addEventListener('submit', function (e) {
        e.preventDefault();
        alert('Message sent successfully!');
        this.reset();
    });
</script>

</html>
